# NGINX HTTPS Setup with Certbot

This project sets up an NGINX web server using Docker Compose to serve static files with HTTPS enabled, leveraging Let’s Encrypt certificates generated by Certbot.

### Features

• Lightweight NGINX container based on the nginx:alpine image.

• Automatic HTTPS certificate generation using Certbot.

• Support for serving custom static files from the html directory.

• Automatic redirection from HTTP to HTTPS.

• Docker Compose for easy deployment and management.
 

### Requirements

• Docker and Docker Compose installed on your server.
 
• A domain name (domain.com) pointing to your server’s IP address.
 
• Certbot installed on your server for certificate generation.

 

## Project Structure

```
├── docker-compose.yaml        # Docker Compose configuration file
├── index.html                 # Example HTML file
├── nginx.conf                 # Custom NGINX configuration file
├── _/                         # Directory for your static website files
├── certs/                     # Directory for SSL certificates
├── css/
├── fonts/
├── openColour/
├── images/
└── README.md                  # Documentation for the setup
```
## Setup Instructions

### 1. Clone the Repository

Clone this repository to your server:
```
git clone <repository-url>
cd <repository-directory>
```

Below is a simple, reliable approach to obtain SSL certificates with Certbot and use them in an NGINX Docker container—without battling volume-mount issues for Let’s Encrypt directories. This method involves two separate steps:
1.	Use Certbot on the host (outside of Docker) to obtain certificates.

2.	Mount the certificates into your Dockerized NGINX.

By doing it this way, you avoid dealing with `/var/lib/letsencrypt` or `/etc/letsencrypt` inside Docker. Once you have your certificates on the host, you simply share them with the NGINX container.

## Option A: Generate Certificates Directly on the Host
### 1.	Stop Any Services on Port 80
Stop or remove any containers or services (like NGINX) that are currently listening on port 80:
```
docker compose down # needs to be done in directory where docker-compose.yml file is for any docker containers listeniing on port 80 
sudo systemctl stop nginx
```
This is necessary because Certbot’s standalone mode needs to bind port 80.

### 2.	Install Certbot on the Host
On Ubuntu/Debian:
```
sudo apt update
sudo apt install certbot
```

### 3.	Obtain the Certificates (Standalone Mode)
Run Certbot to generate certificates using its built-in standalone server

For your main domain:
```
sudo certbot certonly --standalone \
    -d domain.com \
    --email main@domain.com \
    --agree-tos
```

For a subdomain:
```
sudo certbot certonly --standalone \
    -d sub.domain.com \
    --email main@domain.com \
    --agree-tos
```

This will spin up a temporary web server on port 80. Certbot will place certificates in:
```
/etc/letsencrypt/live/domain.com/
```

For a subdomain:
```
/etc/letsencrypt/live/sub.domain.com/
```


### 4.	Verify Certificate Files
After a successful run, check:
For main domain (base domain)
```
sudo ls -l /etc/letsencrypt/live/domain.com/
```

For subdomains
```
sudo ls -l /etc/letsencrypt/live/sub.domain.com/
```

You should see:
* cert.pem
* chain.pem
* fullchain.pem
* privkey.pem

### 5.	Create a Local Directory for Docker

Make a local directory in your project for the certs:
```
cd $HOME/hecate/3-prod
mkdir -p certs
```

Copy your certificates into it the certs directory

For base domain:
```
cd $HOME/hecate/3-prod
sudo cp /etc/letsencrypt/live/domain.com/fullchain.pem certs/
sudo cp /etc/letsencrypt/live/domain.com/privkey.pem certs/
```

For subdomains:
```
cd $HOME/hecate/3-prod
sudo cp /etc/letsencrypt/live/sub.domain.com/fullchain.pem certs/sub.fullchain.pem
sudo cp /etc/letsencrypt/live/sub.domain.com/privkey.pem certs/sub.privkey.pem
```


Adjust permissions to be readable

For the main domain:
```
cd $HOME/hecate/3-prod
sudo chmod 644 certs/fullchain.pem
sudo chmod 600 certs/privkey.pem
```

For subdomains
```
cd $HOME/hecate/3-prod
sudo chmod 644 certs/sub.fullchain.pem
sudo chmod 600 certs/sub.privkey.pem
```

### 8.	Start your docker container
With certificates in place and nginx.conf updated, start your container:
```
cd $HOME/hecate/3-prod
docker compose up -d
```
You should now be able to browse to `https://domain.com`, or for subdomains at `https://sub.domain.com`.


### 9.	Automate Certificate Renewal (Optional)
•	Since Certbot is on your host, just rely on its standard cron-based renewal:
```
sudo certbot renew
```

•	If renewal updates your cert files, copy them again into ./certs/ or symlink them.

•	Then restart the container for changes to take effect:
```
docker-compose restart
```
